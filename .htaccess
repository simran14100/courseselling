# Apache Configuration for React SPA with Node.js Backend
# This file should be placed in your web root directory

# Enable rewrite engine
RewriteEngine On

# Enable proxy module (make sure mod_proxy and mod_proxy_http are enabled)
# If not enabled, run: sudo a2enmod proxy proxy_http rewrite

# Proxy all API requests to Node.js backend
RewriteCond %{REQUEST_URI} ^/api/ [NC]
RewriteRule ^api/(.*)$ http://localhost:4000/api/$1 [P,L]

# Proxy WebSocket requests if needed (for real-time features)
RewriteCond %{HTTP:Upgrade} =websocket [NC]
RewriteRule /(.*) ws://localhost:4000/$1 [P,L]

# For all other requests, proxy to Node.js backend
# This allows React Router to handle client-side routing
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ http://localhost:4000/$1 [P,L]

# Optional: Cache static assets
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType image/jpg "access plus 1 year"
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/gif "access plus 1 year"
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType text/css "access plus 1 month"
  ExpiresByType application/javascript "access plus 1 month"
</IfModule>

# Security headers
<IfModule mod_headers.c>
  Header set X-Content-Type-Options "nosniff"
  Header set X-Frame-Options "SAMEORIGIN"
  Header set X-XSS-Protection "1; mode=block"
</IfModule>

